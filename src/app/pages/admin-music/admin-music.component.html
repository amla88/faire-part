<div class="page-wrapper">
  <mat-card>
    <mat-card-title>Admin • Musiques proposées</mat-card-title>
    <mat-card-content>
      <div *ngIf="error" class="error">{{ error }}</div>
      <div *ngIf="message" [style.color]="messageColor" class="mb8">{{ message }}</div>
      <div class="row mb8">
        <button mat-stroked-button (click)="load()">Rafraîchir</button>
        <mat-select [(ngModel)]="filter" (selectionChange)="load()" class="minw200">
          <mat-option value="all">Tous</mat-option>
          <mat-option value="pending">En attente</mat-option>
          <mat-option value="approved">Approuvés</mat-option>
          <mat-option value="rejected">Rejetés</mat-option>
        </mat-select>
      </div>
    </mat-card-content>
    <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>
  </mat-card>

  <mat-card>
    <mat-card-title>Liste</mat-card-title>
    <mat-card-content>
      <table mat-table [dataSource]="items" class="mat-elevation-z1 full">
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef>ID</th>
          <td mat-cell *matCellDef="let it">{{ it.id }}</td>
        </ng-container>
        <ng-container matColumnDef="m1">
          <th mat-header-cell *matHeaderCellDef>Musique 1</th>
          <td mat-cell *matCellDef="let it">
            <div><strong>{{ it.artist1 }}</strong> — {{ it.title1 }}</div>
            <div class="sub">{{ it.comment1 }}</div>
          </td>
        </ng-container>
        <ng-container matColumnDef="m2">
          <th mat-header-cell *matHeaderCellDef>Musique 2</th>
          <td mat-cell *matCellDef="let it">
            <div><strong>{{ it.artist2 }}</strong> — {{ it.title2 }}</div>
            <div class="sub">{{ it.comment2 }}</div>
          </td>
        </ng-container>
        <ng-container matColumnDef="links">
          <th mat-header-cell *matHeaderCellDef>Liens</th>
          <td mat-cell *matCellDef="let it">
            <div><a *ngIf="it.link1" [href]="it.link1" target="_blank">Lien 1</a></div>
            <div><a *ngIf="it.link2" [href]="it.link2" target="_blank">Lien 2</a></div>
          </td>
        </ng-container>
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Statut</th>
          <td mat-cell *matCellDef="let it">{{ it.status || '—' }}</td>
        </ng-container>
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let it" class="nowrap">
            <button mat-button color="primary" (click)="confirmSetStatus(it.id, 'approved')">
              <mat-icon>check</mat-icon>
              Approuver
            </button>
            <button mat-button color="warn" (click)="confirmSetStatus(it.id, 'rejected')">
              <mat-icon>close</mat-icon>
              Rejeter
            </button>
            <button mat-button (click)="remove(it.id)">
              <mat-icon>delete</mat-icon>
              Supprimer
            </button>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="['id','m1','m2','links','status','actions']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['id','m1','m2','links','status','actions'];"></tr>
      </table>
    </mat-card-content>
  </mat-card>
</div>
