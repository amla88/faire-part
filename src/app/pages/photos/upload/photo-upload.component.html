<mat-card appearance="outlined">
  <mat-card-header>
    <mat-card-title>Téléverser une photo</mat-card-title>
    <mat-card-subtitle>Formats acceptés: JPG, PNG, WebP, GIF. Taille max selon configuration du bucket.</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <div class="picker">
      <input type="file" accept="image/*" (change)="onFileChange($event)" />
    </div>

    @if (fileInfo()) {
      <div class="file-info">
        <small>
          Fichier: {{ fileInfo()!.name }} • Type: {{ fileInfo()!.type }} • Taille: {{ (fileInfo()!.size / 1024) | number:'1.0-0' }} Ko
        </small>
      </div>
    }

    @if (safePreview() || previewUrl()) {
      <div class="preview">
        <img [src]="(safePreview() || previewUrl())!" alt="Aperçu" (error)="onPreviewError()" (load)="onPreviewLoad()" />
      </div>
    }

    @if (previewError()) {
      <div class="hint error">
        <small>Aperçu indisponible pour ce format d'image, mais l'upload fonctionne quand même.</small>
      </div>
    }

    @if (isUploading()) {
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    }
  </mat-card-content>

  <mat-card-actions align="end">
    <button mat-raised-button color="primary" [disabled]="!form.valid || isUploading()" (click)="submit()">
      <mat-icon>cloud_upload</mat-icon>
      Envoyer
    </button>
  </mat-card-actions>
</mat-card>
