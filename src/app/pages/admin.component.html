<div class="admin-wrapper">
  <mat-card>
    <mat-card-title>Admin</mat-card-title>
    <mat-card-content>
      <div *ngIf="error" class="error">{{ error }}</div>
      <div *ngIf="message" [style.color]="messageColor" class="msg">{{ message }}</div>
      <div class="links">
        <a mat-stroked-button routerLink="/admin/assets">Assets avatar</a>
        <a mat-stroked-button routerLink="/admin/music">Musiques</a>
        <a mat-stroked-button routerLink="/admin/photos">Photos</a>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card>
    <mat-card-title>Statistiques</mat-card-title>
    <mat-card-content>
      <button mat-stroked-button (click)="loadStats()" class="mb8">Rafraîchir</button>
      <div *ngIf="stats">
        <div>RSVP total: <strong>{{ stats.rsvp_total }}</strong></div>
        <div>Apéro: <strong>{{ stats.rsvp_apero }}</strong> • Repas: <strong>{{ stats.rsvp_repas }}</strong> • Soirée: <strong>{{ stats.rsvp_soiree }}</strong></div>
        <div>Photos — pending: {{ stats.photos_pending }}, approuvées: {{ stats.photos_approved }}, rejetées: {{ stats.photos_rejected }}</div>
        <div>Musiques — pending: {{ stats.musiques_pending }}, approuvées: {{ stats.musiques_approved }}, rejetées: {{ stats.musiques_rejected }}</div>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card>
    <mat-card-title>Ajouter une famille</mat-card-title>
    <mat-card-content>
      <form (ngSubmit)="addUser()" #f="ngForm" class="row">
        <mat-form-field appearance="outline">
          <mat-label>Prénom</mat-label>
          <input matInput [(ngModel)]="newPrenom" name="prenom" required />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Nom</mat-label>
          <input matInput [(ngModel)]="newNom" name="nom" required />
        </mat-form-field>
        <button mat-raised-button color="primary" type="submit" [disabled]="adding">Ajouter</button>
      </form>
      <div *ngIf="addedLink" class="mt8">Lien: <a [href]="addedLink" target="_blank">{{ addedLink }}</a></div>
    </mat-card-content>
  </mat-card>

  <mat-card>
    <mat-card-title>Liste des familles</mat-card-title>
    <mat-card-content>
      <button mat-stroked-button (click)="loadUsers()" class="mb8">Rafraîchir</button>
      <div *ngIf="loading">Chargement…</div>
      <table *ngIf="!loading" mat-table [dataSource]="users" class="mat-elevation-z1 full">
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef>ID</th>
          <td mat-cell *matCellDef="let u">{{ u.id }}</td>
        </ng-container>
        <ng-container matColumnDef="token">
          <th mat-header-cell *matHeaderCellDef>Token</th>
          <td mat-cell *matCellDef="let u"><code>{{ u.login_token }}</code></td>
        </ng-container>
        <ng-container matColumnDef="personnes">
          <th mat-header-cell *matHeaderCellDef>Personnes</th>
          <td mat-cell *matCellDef="let u">{{ personNames(u) }}</td>
        </ng-container>
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let u">
            <button mat-button (click)="openGame(u.login_token)">Ouvrir</button>
            <button mat-button (click)="copyLink(u.login_token)">Copier le lien</button>
            <button mat-button color="warn" (click)="deleteUser(u.login_token)">Supprimer</button>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="['id','token','personnes','actions']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['id','token','personnes','actions'];"></tr>
      </table>
    </mat-card-content>
  </mat-card>
</div>
