import{a as xe,b as De,c as we,d as ye,e as Fe,f as Se,g as be,h as Ae,i as Ie,j as Te,k as Ee}from"./chunk-PROI5D7Z.js";import{a as re,b as oe,c as le,f as me,j as se,n as pe,o as fe,p as ue,q as _e,r as ge,s as he,t as Ce,u as E}from"./chunk-RLNM4WJ2.js";import{a as Z,b as ee}from"./chunk-N2Q4NVWM.js";import{b as J,g as K,j as Y}from"./chunk-EIMTKMSA.js";import{V as I,W as T,X as ve,Y as Me}from"./chunk-BDQMN6JN.js";import{a as de,b as ce}from"./chunk-ELI3AYMP.js";import{d as U,i as W}from"./chunk-32H5EB4Z.js";import{a as Le}from"./chunk-ALS2BQDB.js";import"./chunk-LKTWXCPZ.js";import{Ea as ae,h as z,i as G,n as b,sa as Q,ta as X,wa as A,xa as te,ya as ie,za as ne}from"./chunk-F7FO76QX.js";import{Ab as g,Bc as H,Ib as P,Mc as q,Ob as d,Pb as r,Qb as o,Rb as C,Vb as F,Wb as S,Yb as k,ab as O,ac as v,cb as l,cc as h,ob as _,pa as x,pc as N,qa as D,qc as s,rc as B,sc as u,t as R,tc as V,ub as y,za as w}from"./chunk-ROP7NO4L.js";import{m as M}from"./chunk-SIIEGW5O.js";var j=(()=>{let a=class a{constructor(n,i){this.dialogRef=n,this.data=i}};a.\u0275fac=function(i){return new(i||a)(_(pe),_(fe))},a.\u0275cmp=y({type:a,selectors:[["app-confirm-dialog"]],decls:11,vars:10,consts:[["mat-dialog-title","",1,"mat-subtitle-1","d-flex","align-items-center"],[1,"m-r-8"],["mat-dialog-content","",1,"f-s-14","lh-16","p-t-8"],["mat-dialog-actions","",1,"p-24","p-t-0","d-flex","justify-end","gap-8"],["mat-flat-button","","mat-dialog-close","",1,"m-r-8"],["mat-flat-button","","cdkFocusInitial","",3,"mat-dialog-close"]],template:function(i,e){i&1&&(r(0,"h5",0)(1,"mat-icon",1),s(2),o(),s(3),o(),r(4,"div",2),s(5),o(),r(6,"div",3)(7,"button",4),s(8),o(),r(9,"button",5),s(10),o()()),i&2&&(l(),N(e.data.isDanger?"text-error":"text-warning"),l(),u(" ",e.data.isDanger?"warning":"help_outline"," "),l(),u(" ",e.data.title," "),l(2),u(" ",e.data.message," "),l(3),u(" ",e.data.cancelText||"Annuler"," "),l(),N(e.data.isDanger?"bg-error text-white":"bg-primary text-white"),d("mat-dialog-close",!0),l(),u(" ",e.data.confirmText||"Confirmer"," "))},dependencies:[b,E,_e,ge,Ce,he,A,X,T,I],encapsulation:2,changeDetection:0});let t=a;return t})();var $e=()=>[];function Oe(t,a){t&1&&(r(0,"th",19),s(1,"Famille"),o())}function Pe(t,a){if(t&1&&(r(0,"td",20)(1,"div")(2,"h6",21),s(3),o(),r(4,"div",22),s(5),o()()()),t&2){let m=a.$implicit,n=h(2);l(3),B(n.getFamilyDisplayName(m)),l(2),u("ID: ",m.id)}}function Be(t,a){t&1&&(r(0,"th",23),s(1,"Personnes"),o())}function Ve(t,a){if(t&1){let m=k();r(0,"mat-chip",26),C(1,"img",27),s(2),r(3,"button",28),v("click",function(){let i=x(m).$implicit,e=h().$implicit,f=h(2);return D(f.deletePerson(e.id,i.id))}),r(4,"mat-icon"),s(5,"delete"),o()()()}if(t&2){let m=a.$implicit;l(),d("src",m.avatar_url||"assets/images/profile/user-1.jpg",O),l(),V(" ",m.prenom," ",m.nom," "),l(),P("aria-label","Supprimer "+m.prenom+" "+m.nom)}}function He(t,a){if(t&1&&(r(0,"td",24)(1,"mat-chip-set"),g(2,Ve,6,4,"mat-chip",25),o()()),t&2){let m=a.$implicit;l(2),d("ngForOf",m.personnes||H(1,$e))}}function qe(t,a){t&1&&C(0,"th",23)}function ze(t,a){if(t&1){let m=k();r(0,"td",24)(1,"button",29),v("click",function(){let i=x(m).$implicit,e=h(2);return D(e.goToDetails(i))}),r(2,"mat-icon"),s(3,"open_in_new"),o()(),r(4,"button",30),v("click",function(){let i=x(m).$implicit,e=h(2);return D(e.deleteFamille(i.id))}),r(5,"mat-icon"),s(6,"delete_forever"),o()()()}}function Ge(t,a){t&1&&C(0,"tr",31)}function Ue(t,a){t&1&&C(0,"tr",32)}function We(t,a){if(t&1&&(r(0,"div",8)(1,"table",9),F(2,10),g(3,Oe,2,0,"th",11)(4,Pe,6,2,"td",12),S(),F(5,13),g(6,Be,2,0,"th",14)(7,He,3,2,"td",15),S(),F(8,16),g(9,qe,1,0,"th",14)(10,ze,7,0,"td",15),S(),g(11,Ge,1,0,"tr",17)(12,Ue,1,0,"tr",18),o()()),t&2){let m=h();l(),d("dataSource",m.filteredFamilles()),l(10),d("matHeaderRowDef",m.displayedColumns),l(),d("matRowDefColumns",m.displayedColumns)}}function Je(t,a){t&1&&(r(0,"div",33),C(1,"mat-progress-spinner",34),o())}function Ke(t,a){t&1&&(r(0,"div",35),s(1," Aucune famille trouv\xE9e. "),o())}var Rt=(()=>{let a=class a{getFamilyDisplayName(n){if(!n)return"Famille";let i=n.personne_principale;if(i&&Array.isArray(n.personnes)){let e=n.personnes.find(f=>f.id===i);if(e)return`Famille ${e.prenom} ${e.nom}`}if(Array.isArray(n.personnes)&&n.personnes.length>0){let e=n.personnes[0];return`Famille ${e.prenom} ${e.nom}`}return`Famille #${n.id}`}constructor(n,i,e,f){this.ngSupabase=n,this.router=i,this.dialog=e,this.snackBar=f,this.familles=w([]),this.loading=w(!1),this.displayedColumns=["name","persons","actions"],this.filter=w(""),this.filteredFamilles=q(()=>{let c=(this.filter()||"").toLowerCase().trim();return c?this.familles().filter(p=>{if(this.getFamilyDisplayName(p).toLowerCase().includes(c)||(p.id+"").includes(c))return!0;if(Array.isArray(p.personnes)){for(let $ of p.personnes)if((($.prenom||"")+" "+($.nom||"")).toLowerCase().includes(c))return!0}return!1}):this.familles()})}ngOnInit(){this.loadFamilles()}loadFamilles(){return M(this,null,function*(){this.loading.set(!0);try{let i=yield this.ngSupabase.getClient().from("familles").select("*, personnes!personnes_famille_id_fkey(*)");if(i.error)throw i.error;let e=Array.isArray(i.data)?i.data:[];this.familles.set(e)}catch(n){console.error("Erreur chargement familles",n),this.familles.set([])}finally{this.loading.set(!1)}})}goToDetails(n){this.router.navigate(["admin","famille",n.id])}deletePerson(n,i){return M(this,null,function*(){let e={title:"Supprimer la personne",message:"\xCAtes-vous s\xFBr de vouloir supprimer cette personne ? Cette action est irr\xE9versible.",confirmText:"Supprimer",cancelText:"Annuler",isDanger:!0},f=this.dialog.open(j,{width:"400px",data:e,enterAnimationDuration:"300ms",exitAnimationDuration:"200ms"});if(yield R(f.afterClosed()))try{let L=yield this.ngSupabase.getClient().from("personnes").delete().eq("id",i);if(L.error)throw L.error;yield this.loadFamilles()}catch(p){console.error("Erreur suppression personne",p),this.snackBar.open("Erreur lors de la suppression de la personne","Fermer",{duration:5e3})}})}deleteFamille(n){return M(this,null,function*(){let i={title:"Supprimer la famille",message:"\xCAtes-vous s\xFBr de vouloir supprimer cette famille et toutes ses personnes ? Cette action est irr\xE9versible.",confirmText:"Supprimer",cancelText:"Annuler",isDanger:!0},e=this.dialog.open(j,{width:"450px",data:i,enterAnimationDuration:"300ms",exitAnimationDuration:"200ms"});if(yield R(e.afterClosed()))try{let p=yield this.ngSupabase.getClient().from("familles").delete().eq("id",n);if(p.error)throw p.error;yield this.loadFamilles()}catch(c){console.error("Erreur suppression famille",c),this.snackBar.open("Erreur lors de la suppression de la famille","Fermer",{duration:5e3})}})}};a.\u0275fac=function(i){return new(i||a)(_(Le),_(U),_(ue),_(ve))},a.\u0275cmp=y({type:a,selectors:[["app-admin-famille-list"]],decls:14,vars:4,consts:[[1,"cardWithShadow"],[1,"m-b-12"],["appearance","outline",1,"w-50"],["matInput","","placeholder","Nom, id ou personne...",3,"input"],[1,"f-s-13","text-muted","m-t-8"],["class","table-responsive",4,"ngIf"],["class","d-flex justify-center p-24",4,"ngIf"],["class","p-16 text-muted",4,"ngIf"],[1,"table-responsive"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","class","f-w-600 f-s-14 p-l-0",4,"matHeaderCellDef"],["mat-cell","","class","p-l-0",4,"matCellDef"],["matColumnDef","persons"],["mat-header-cell","","class","f-w-600 f-s-14",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"f-w-600","f-s-14","p-l-0"],["mat-cell","",1,"p-l-0"],[1,"f-s-14","f-w-600"],[1,"f-s-13","text-muted"],["mat-header-cell","",1,"f-w-600","f-s-14"],["mat-cell",""],["class","f-s-14",4,"ngFor","ngForOf"],[1,"f-s-14"],["matChipAvatar","","alt","avatar",3,"src"],["matChipRemove","","color","warn",3,"click"],["mat-icon-button","","color","primary","aria-label","D\xE9tails de la famille",3,"click"],["mat-icon-button","","color","warn","aria-label","Supprimer la famille",3,"click"],["mat-header-row",""],["mat-row",""],[1,"d-flex","justify-center","p-24"],["mode","indeterminate"],[1,"p-16","text-muted"]],template:function(i,e){i&1&&(r(0,"mat-card",0)(1,"mat-card-content")(2,"mat-card-title"),s(3,"Liste des familles"),o(),r(4,"div",1)(5,"mat-form-field",2)(6,"mat-label"),s(7,"Rechercher familles / personnes"),o(),r(8,"input",3),v("input",function(c){return e.filter.set(c.target.value)}),o()(),r(9,"div",4),s(10),o()(),g(11,We,13,3,"div",5)(12,Je,2,0,"div",6)(13,Ke,2,0,"div",7),o()()),i&2&&(l(10),u("R\xE9sultats : ",e.filteredFamilles().length),l(),d("ngIf",!e.loading()),l(),d("ngIf",e.loading()),l(),d("ngIf",!e.loading()&&(!e.familles()||e.familles().length===0)))},dependencies:[b,z,G,W,ae,te,ne,ie,Ee,xe,we,be,ye,De,Ae,Fe,Se,Ie,Te,se,le,re,oe,me,T,I,A,Q,ce,de,E,Me,Y,K,J,ee,Z],styles:[".person-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;margin:4px}.person-chip[_ngcontent-%COMP%]   img[matChipAvatar][_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;object-fit:cover;margin-right:8px}.table-responsive[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}"],changeDetection:0});let t=a;return t})();export{Rt as AdminFamilleListComponent};
