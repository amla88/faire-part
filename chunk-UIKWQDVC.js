import{b as J,c as K}from"./chunk-G3F2VJY2.js";import{a as Z,b as ee}from"./chunk-N2Q4NVWM.js";import{b as V,e as te,f as ie}from"./chunk-DCQGY5E7.js";import{b as W,c as z,g as H,j as Y}from"./chunk-EIMTKMSA.js";import{B as E,E as B,F as G,K as O,N as j,O as q,P as D,Q as R,S as L,U as $,V as me,W as se,X as pe,Y as de,z as T}from"./chunk-BDQMN6JN.js";import{a as ue}from"./chunk-ALS2BQDB.js";import"./chunk-LKTWXCPZ.js";import{Ca as ae,Ea as le,h as P,i as k,n as A,ta as Q,va as U,wa as X,xa as ne,ya as re,za as oe}from"./chunk-F7FO76QX.js";import{Ab as u,Ob as s,Pb as e,Qb as t,Rb as c,Yb as w,ac as _,cb as m,cc as h,ob as b,pa as C,qa as y,qc as i,rc as g,sc as N,ub as I}from"./chunk-ROP7NO4L.js";import{m as F}from"./chunk-SIIEGW5O.js";function ce(r,a){if(r&1&&(e(0,"mat-option",25),i(1),t()),r&2){let p=a.$implicit;s("value",p.value),m(),g(p.viewValue)}}function fe(r,a){if(r&1&&(e(0,"mat-option",25),i(1),t()),r&2){let p=a.$implicit;s("value",p.value),m(),g(p.viewValue)}}function ve(r,a){r&1&&(e(0,"small"),i(1,"(personne principale)"),t())}function _e(r,a){r&1&&(e(0,"mat-error"),i(1,"Le nom est requis."),t())}function he(r,a){r&1&&(e(0,"mat-error"),i(1,"Le pr\xE9nom est requis."),t())}function ge(r,a){r&1&&(e(0,"mat-error"),i(1,"Email invalide."),t())}function be(r,a){if(r&1){let p=w();e(0,"div",26)(1,"h3",27),i(2),u(3,ve,2,0,"small",28),t(),e(4,"div",29)(5,"div",30)(6,"mat-label",7),i(7,"Nom"),t(),e(8,"mat-form-field",8),c(9,"input",31),u(10,_e,2,0,"mat-error",28),t()(),e(11,"div",30)(12,"mat-label",7),i(13,"Pr\xE9nom"),t(),e(14,"mat-form-field",8),c(15,"input",32),u(16,he,2,0,"mat-error",28),t()(),e(17,"div",30)(18,"mat-label",7),i(19,"Email"),t(),e(20,"mat-form-field",8),c(21,"input",33),u(22,ge,2,0,"mat-error",28),t()(),e(23,"div",6)(24,"mat-label",7),i(25,"Invit\xE9 pour"),t(),e(26,"div",34)(27,"mat-checkbox",35),i(28,"R\xE9ception"),t(),e(29,"mat-checkbox",36),i(30,"Repas"),t(),e(31,"mat-checkbox",37),i(32,"Soir\xE9e"),t()()()(),e(33,"div",38)(34,"button",39),_("click",function(){C(p);let l=h();return y(l.addPerson())}),e(35,"mat-icon"),i(36,"add"),t()(),e(37,"button",40),_("click",function(){let l=C(p).index,n=h();return y(n.removePerson(l))}),e(38,"mat-icon"),i(39,"remove"),t()()()()}if(r&2){let p,o,l,n=a.$implicit,d=a.index,S=h();s("formGroupName",d),m(2),N("Personne ",d+1," "),m(),s("ngIf",d===0),m(7),s("ngIf",((p=n.get("nom"))==null?null:p.invalid)&&((p=n.get("nom"))==null?null:p.touched)),m(6),s("ngIf",((o=n.get("prenom"))==null?null:o.invalid)&&((o=n.get("prenom"))==null?null:o.touched)),m(6),s("ngIf",((l=n.get("email"))==null?null:l.invalid)&&((l=n.get("email"))==null?null:l.touched)),m(15),s("disabled",S.persons.controls.length<=1)}}function Ee(r,a){if(r&1&&(e(0,"div",41),i(1),t()),r&2){let p=h();m(),g(p.message)}}var We=(()=>{let a=class a{constructor(o,l,n){this.fb=o,this.ngSupabase=l,this.snackBar=n,this.countries=[{value:"France",viewValue:"France"},{value:"Belgique",viewValue:"Belgique"},{value:"Suisse",viewValue:"Suisse"},{value:"England",viewValue:"Angleterre"},{value:"Spain",viewValue:"Espagne"},{value:"Italy",viewValue:"Italie"}],this.form=this.fb.group({rue:[""],numero:[""],boite:[""],cp:[""],ville:[""],pays:["Belgique"],persons:this.fb.array([this.createPersonGroup()])}),this.loading=!1,this.message=""}createPersonGroup(){return this.fb.group({nom:["",E.required],prenom:["",E.required],email:["",[E.email]],invite_reception:[!0],invite_repas:[!0],invite_soiree:[!0]})}get persons(){return this.form.get("persons")}addPerson(){this.persons.push(this.createPersonGroup())}removePerson(o){this.persons.length<=1||this.persons.removeAt(o)}submit(){return F(this,null,function*(){if(this.form.invalid){this.form.markAllAsTouched();return}this.loading=!0,this.message="";try{let o=this.ngSupabase.getClient(),l={personne_principale:null,rue:this.form.value.rue||null,numero:this.form.value.numero||null,boite:this.form.value.boite||null,cp:this.form.value.cp||null,ville:this.form.value.ville||null,pays:this.form.value.pays||null},n=yield o.from("familles").insert(l).select("id");if(n.error)throw n.error;let d=n.data?.[0]?.id;if(!d)throw new Error("Impossible de r\xE9cup\xE9rer l'id de la famille");let S=this.persons.controls.map(v=>{let f=v;return{nom:f.value.nom,prenom:f.value.prenom,email:f.value.email||null,invite_reception:!!f.value.invite_reception,invite_repas:!!f.value.invite_repas,invite_soiree:!!f.value.invite_soiree,famille_id:d}}),x=yield o.from("personnes").insert(S).select("id");if(x.error)throw x.error;let M=x.data?.[0]?.id;if(M){let v=yield o.from("familles").update({personne_principale:M}).eq("id",d);if(v.error)throw v.error}this.message="Famille et personnes ajout\xE9es.";try{this.snackBar.open("Famille et personnes ajout\xE9es.","Fermer",{duration:4e3})}catch{}this.form.reset(),this.form.setControl("persons",this.fb.array([this.createPersonGroup()]))}catch(o){console.error(o),this.message="Erreur lors de l'insertion : "+(o?.message??o);try{this.snackBar.open("Erreur lors de l'insertion : "+(o?.message??""),"Fermer",{duration:6e3})}catch{}}finally{this.loading=!1}})}};a.\u0275fac=function(l){return new(l||a)(b(L),b(ue),b(pe))},a.\u0275cmp=I({type:a,selectors:[["app-admin-famille"]],decls:64,vars:8,consts:[[1,"p-24","admin-famille"],[1,"cardWithShadow","theme-card"],[1,"m-b-0"],[1,"b-t-1"],[3,"ngSubmit","formGroup"],[1,"row"],[1,"col-lg-6"],[1,"f-w-600","m-b-8","d-block"],["appearance","outline",1,"w-100"],["formControlName","pays"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","text","formControlName","rue","placeholder","Rue"],[1,"col-lg-3"],["matInput","","type","text","formControlName","numero","placeholder","Num\xE9ro"],["matInput","","type","text","formControlName","boite","placeholder","Bo\xEEte"],["matInput","","type","text","formControlName","cp","placeholder","CP"],["matInput","","type","text","formControlName","ville","placeholder","Ville"],[1,"m-t-12"],["mat-flat-button","","color","primary","type","submit",1,"m-r-8",3,"disabled"],["mat-stroked-button","","color","warn","type","button",3,"click"],[1,"cardWithShadow","theme-card","m-t-12"],[3,"formGroup"],["formArrayName","persons"],["class","person-item m-b-8 p-8 b-t-1",3,"formGroupName",4,"ngFor","ngForOf"],["class","mt-4",4,"ngIf"],[3,"value"],[1,"person-item","m-b-8","p-8","b-t-1",3,"formGroupName"],[1,"m-0"],[4,"ngIf"],[1,"row","m-t-8"],[1,"col-lg-4"],["matInput","","type","text","formControlName","nom","placeholder","Nom"],["matInput","","type","text","formControlName","prenom","placeholder","Pr\xE9nom"],["matInput","","type","email","formControlName","email","placeholder","Email"],[1,"checkbox-group"],["formControlName","invite_reception"],["formControlName","invite_repas"],["formControlName","invite_soiree"],[1,"m-t-8"],["mat-mini-fab","","color","primary","type","button","aria-label","Ajouter personne",3,"click"],["mat-mini-fab","","color","warn","type","button","aria-label","Supprimer personne",3,"click","disabled"],[1,"mt-4"]],template:function(l,n){l&1&&(e(0,"div",0)(1,"h2"),i(2,"Ajouter une famille (table familles)"),t(),e(3,"mat-card",1)(4,"mat-card-header")(5,"mat-card-title",2),i(6,"Famille"),t()(),e(7,"mat-card-content",3)(8,"form",4),_("ngSubmit",function(){return n.submit()}),e(9,"div",5)(10,"div",6)(11,"mat-label",7),i(12,"Pays"),t(),e(13,"mat-form-field",8)(14,"mat-select",9),u(15,ce,2,2,"mat-option",10),t()()(),e(16,"div",6)(17,"mat-label",7),i(18,"Rue"),t(),e(19,"mat-form-field",8),c(20,"input",11),t()(),e(21,"div",12)(22,"mat-label",7),i(23,"Num\xE9ro"),t(),e(24,"mat-form-field",8),c(25,"input",13),t()(),e(26,"div",12)(27,"mat-label",7),i(28,"Bo\xEEte"),t(),e(29,"mat-form-field",8),c(30,"input",14),t()(),e(31,"div",12)(32,"mat-label",7),i(33,"Code postal"),t(),e(34,"mat-form-field",8),c(35,"input",15),t()(),e(36,"div",12)(37,"mat-label",7),i(38,"Ville"),t(),e(39,"mat-form-field",8),c(40,"input",16),t()(),e(41,"div",6)(42,"mat-label",7),i(43,"Pays"),t(),e(44,"mat-form-field",8)(45,"mat-select",9),u(46,fe,2,2,"mat-option",10),t()()()(),e(47,"div",17)(48,"button",18),i(49),t(),e(50,"button",19),_("click",function(){return n.form.reset()}),i(51,"Annuler"),t()()()()(),e(52,"mat-card",20)(53,"mat-card-header")(54,"mat-card-title",2),i(55,"Personnes"),t()(),e(56,"mat-card-content",3)(57,"div",21)(58,"div",22),u(59,be,40,7,"div",23),t()(),e(60,"div",17)(61,"small"),i(62,"Minimum 1 personne obligatoire (personne principale). Vous pouvez en ajouter autant que n\xE9cessaire."),t()()()(),u(63,Ee,2,1,"div",24),t()),l&2&&(m(8),s("formGroup",n.form),m(7),s("ngForOf",n.countries),m(31),s("ngForOf",n.countries),m(2),s("disabled",n.form.invalid||n.loading),m(),g(n.loading?"En cours...":"Ajouter"),m(8),s("formGroup",n.form),m(2),s("ngForOf",n.persons.controls),m(4),s("ngIf",n.message))},dependencies:[A,P,k,$,O,T,B,G,j,R,q,D,le,ne,oe,ae,re,Y,H,W,z,ee,Z,ie,te,V,K,J,de,X,Q,U,se,me],styles:[".admin-famille[_ngcontent-%COMP%]{padding:1rem}.admin-famille[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600}.admin-famille[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{cursor:pointer}"],changeDetection:0});let r=a;return r})();export{We as AdminFamilleComponent};
