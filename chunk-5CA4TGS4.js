import{d as de,e as pe,f as fe,g as ue,h as ge,i as _e,j as he,k as Ce,l as xe,m as we,n as ye,o as De,p as be,q as Fe,r as Se,s as Ie,t as Ae,u as Ee,v as Te}from"./chunk-ZSBXDNJS.js";import{a as ae,b as re,c as oe,f as le,j as me}from"./chunk-4LRKX244.js";import{a as Y,b as Z}from"./chunk-PWJZ2LNL.js";import{b as W,g as J,j as X}from"./chunk-2KVVKINI.js";import{V as A,W as E,X as ve,Y as Me}from"./chunk-OC4T4DRE.js";import{a as se,b as ce}from"./chunk-ZZPVTA7Y.js";import{d as G,i as U}from"./chunk-XYN5C5AP.js";import{a as Oe}from"./chunk-JPTBIBXE.js";import"./chunk-LKTWXCPZ.js";import{Ea as ne,h as q,i as z,n as S,sa as K,ta as Q,wa as I,xa as ee,ya as te,za as ie}from"./chunk-4THFQO72.js";import{Ab as _,Bc as V,Ib as N,Mc as H,Ob as d,Pb as r,Qb as o,Rb as C,Vb as b,Wb as F,Yb as T,ab as R,ac as v,cb as l,cc as h,ea as k,ia as j,ob as u,pa as x,pc as O,qa as w,qc as s,rc as $,sc as f,t as L,tc as B,ub as D,za as y}from"./chunk-XRA3D6DW.js";import{m as M}from"./chunk-SIIEGW5O.js";var Le=(()=>{let i=class i{constructor(a,n){this.dialogRef=a,this.data=n}};i.\u0275fac=function(n){return new(n||i)(u(de),u(pe))},i.\u0275cmp=D({type:i,selectors:[["app-confirm-dialog"]],decls:11,vars:10,consts:[["mat-dialog-title","",1,"mat-subtitle-1","d-flex","align-items-center"],[1,"m-r-8"],["mat-dialog-content","",1,"f-s-14","lh-16","p-t-8"],["mat-dialog-actions","",1,"p-24","p-t-0","d-flex","justify-end","gap-8"],["mat-flat-button","","mat-dialog-close","",1,"m-r-8"],["mat-flat-button","","cdkFocusInitial","",3,"mat-dialog-close"]],template:function(n,t){n&1&&(r(0,"h5",0)(1,"mat-icon",1),s(2),o(),s(3),o(),r(4,"div",2),s(5),o(),r(6,"div",3)(7,"button",4),s(8),o(),r(9,"button",5),s(10),o()()),n&2&&(l(),O(t.data.isDanger?"text-error":"text-warning"),l(),f(" ",t.data.isDanger?"warning":"help_outline"," "),l(),f(" ",t.data.title,`
`),l(2),f(" ",t.data.message,`
`),l(3),f(" ",t.data.cancelText||"Annuler"," "),l(),O(t.data.isDanger?"bg-error text-white":"bg-primary text-white"),d("mat-dialog-close",!0),l(),f(" ",t.data.confirmText||"Confirmer"," "))},dependencies:[S,Ce,ue,ge,he,_e,I,Q,E,A],styles:[".mat-subtitle-1[_ngcontent-%COMP%]{font-weight:600}.text-error[_ngcontent-%COMP%]{color:var(--danger, #d32f2f)}.text-warning[_ngcontent-%COMP%]{color:var(--warning, #f57c00)}.m-r-8[_ngcontent-%COMP%]{margin-right:8px}.f-s-14[_ngcontent-%COMP%]{font-size:14px}.lh-16[_ngcontent-%COMP%]{line-height:16px}.p-t-8[_ngcontent-%COMP%]{padding-top:8px}.p-24[_ngcontent-%COMP%]{padding:24px}.p-t-0[_ngcontent-%COMP%]{padding-top:0}.d-flex[_ngcontent-%COMP%]{display:flex}.justify-end[_ngcontent-%COMP%]{justify-content:flex-end}.gap-8[_ngcontent-%COMP%]{gap:8px}.bg-error[_ngcontent-%COMP%]{background-color:var(--danger, #d32f2f)}.bg-primary[_ngcontent-%COMP%]{background-color:var(--primary, #1976d2)}.text-white[_ngcontent-%COMP%]{color:#fff}"],changeDetection:0});let e=i;return e})();var ke=(()=>{let i=class i{constructor(a){this.dialog=a}confirm(a){let n=this.dialog.open(Le,{width:"420px",data:a,disableClose:!0,autoFocus:!0});return L(n.afterClosed()).then(t=>!!t)}};i.\u0275fac=function(n){return new(n||i)(j(fe))},i.\u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"});let e=i;return e})();var Be=()=>[];function Ve(e,i){e&1&&(r(0,"th",19),s(1,"Famille"),o())}function He(e,i){if(e&1&&(r(0,"td",20)(1,"div")(2,"h6",21),s(3),o(),r(4,"div",22),s(5),o()()()),e&2){let m=i.$implicit,a=h(2);l(3),$(a.getFamilyDisplayName(m)),l(2),f("ID: ",m.id)}}function qe(e,i){e&1&&(r(0,"th",23),s(1,"Personnes"),o())}function ze(e,i){if(e&1){let m=T();r(0,"mat-chip",26),C(1,"img",27),s(2),r(3,"button",28),v("click",function(){let n=x(m).$implicit,t=h().$implicit,p=h(2);return w(p.deletePerson(t.id,n.id))}),r(4,"mat-icon"),s(5,"delete"),o()()()}if(e&2){let m=i.$implicit;l(),d("src",m.avatar_url||"assets/images/profile/user-1.jpg",R),l(),B(" ",m.prenom," ",m.nom," "),l(),N("aria-label","Supprimer "+m.prenom+" "+m.nom)}}function Ge(e,i){if(e&1&&(r(0,"td",24)(1,"mat-chip-set"),_(2,ze,6,4,"mat-chip",25),o()()),e&2){let m=i.$implicit;l(2),d("ngForOf",m.personnes||V(1,Be))}}function Ue(e,i){e&1&&C(0,"th",23)}function We(e,i){if(e&1){let m=T();r(0,"td",24)(1,"button",29),v("click",function(){let n=x(m).$implicit,t=h(2);return w(t.goToDetails(n))}),r(2,"mat-icon"),s(3,"open_in_new"),o()(),r(4,"button",30),v("click",function(){let n=x(m).$implicit,t=h(2);return w(t.deleteFamille(n.id))}),r(5,"mat-icon"),s(6,"delete_forever"),o()()()}}function Je(e,i){e&1&&C(0,"tr",31)}function Ke(e,i){e&1&&C(0,"tr",32)}function Qe(e,i){if(e&1&&(r(0,"div",8)(1,"table",9),b(2,10),_(3,Ve,2,0,"th",11)(4,He,6,2,"td",12),F(),b(5,13),_(6,qe,2,0,"th",14)(7,Ge,3,2,"td",15),F(),b(8,16),_(9,Ue,1,0,"th",14)(10,We,7,0,"td",15),F(),_(11,Je,1,0,"tr",17)(12,Ke,1,0,"tr",18),o()()),e&2){let m=h();l(),d("dataSource",m.filteredFamilles()),l(10),d("matHeaderRowDef",m.displayedColumns),l(),d("matRowDefColumns",m.displayedColumns)}}function Xe(e,i){e&1&&(r(0,"div",33),C(1,"mat-progress-spinner",34),o())}function Ye(e,i){e&1&&(r(0,"div",35),s(1," Aucune famille trouv\xE9e. "),o())}var Ot=(()=>{let i=class i{getFamilyDisplayName(a){if(!a)return"Famille";let n=a.personne_principale;if(n&&Array.isArray(a.personnes)){let t=a.personnes.find(p=>p.id===n);if(t)return`Famille ${t.prenom} ${t.nom}`}if(Array.isArray(a.personnes)&&a.personnes.length>0){let t=a.personnes[0];return`Famille ${t.prenom} ${t.nom}`}return`Famille #${a.id}`}constructor(a,n,t,p){this.ngSupabase=a,this.router=n,this.confirmDialog=t,this.snackBar=p,this.familles=y([]),this.loading=y(!1),this.displayedColumns=["name","persons","actions"],this.filter=y(""),this.filteredFamilles=H(()=>{let c=(this.filter()||"").toLowerCase().trim();return c?this.familles().filter(g=>{if(this.getFamilyDisplayName(g).toLowerCase().includes(c)||(g.id+"").includes(c))return!0;if(Array.isArray(g.personnes)){for(let P of g.personnes)if(((P.prenom||"")+" "+(P.nom||"")).toLowerCase().includes(c))return!0}return!1}):this.familles()})}ngOnInit(){this.loadFamilles()}loadFamilles(){return M(this,null,function*(){this.loading.set(!0);try{let n=yield this.ngSupabase.getClient().from("familles").select("*, personnes!personnes_famille_id_fkey(*)");if(n.error)throw n.error;let t=Array.isArray(n.data)?n.data:[];this.familles.set(t)}catch(a){console.error("Erreur chargement familles",a),this.familles.set([])}finally{this.loading.set(!1)}})}goToDetails(a){this.router.navigate(["admin","famille",a.id])}deletePerson(a,n){return M(this,null,function*(){let t={title:"Supprimer la personne",message:"\xCAtes-vous s\xFBr de vouloir supprimer cette personne ? Cette action est irr\xE9versible.",confirmText:"Supprimer",cancelText:"Annuler",isDanger:!0};if(yield this.confirmDialog.confirm(t))try{let g=yield this.ngSupabase.getClient().from("personnes").delete().eq("id",n);if(g.error)throw g.error;yield this.loadFamilles()}catch(c){console.error("Erreur suppression personne",c),this.snackBar.open("Erreur lors de la suppression de la personne","Fermer",{duration:5e3})}})}deleteFamille(a){return M(this,null,function*(){let n={title:"Supprimer la famille",message:"\xCAtes-vous s\xFBr de vouloir supprimer cette famille et toutes ses personnes ? Cette action est irr\xE9versible.",confirmText:"Supprimer",cancelText:"Annuler",isDanger:!0};if(yield this.confirmDialog.confirm(n))try{let c=yield this.ngSupabase.getClient().from("familles").delete().eq("id",a);if(c.error)throw c.error;yield this.loadFamilles()}catch(p){console.error("Erreur suppression famille",p),this.snackBar.open("Erreur lors de la suppression de la famille","Fermer",{duration:5e3})}})}};i.\u0275fac=function(n){return new(n||i)(u(Oe),u(G),u(ke),u(ve))},i.\u0275cmp=D({type:i,selectors:[["app-admin-famille-list"]],decls:14,vars:4,consts:[[1,"cardWithShadow"],[1,"m-b-12"],["appearance","outline",1,"w-50"],["matInput","","placeholder","Nom, id ou personne...",3,"input"],[1,"f-s-13","text-muted","m-t-8"],["class","table-responsive",4,"ngIf"],["class","d-flex justify-center p-24",4,"ngIf"],["class","p-16 text-muted",4,"ngIf"],[1,"table-responsive"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","class","f-w-600 f-s-14 p-l-0",4,"matHeaderCellDef"],["mat-cell","","class","p-l-0",4,"matCellDef"],["matColumnDef","persons"],["mat-header-cell","","class","f-w-600 f-s-14",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"f-w-600","f-s-14","p-l-0"],["mat-cell","",1,"p-l-0"],[1,"f-s-14","f-w-600"],[1,"f-s-13","text-muted"],["mat-header-cell","",1,"f-w-600","f-s-14"],["mat-cell",""],["class","f-s-14",4,"ngFor","ngForOf"],[1,"f-s-14"],["matChipAvatar","","alt","avatar",3,"src"],["matChipRemove","","color","warn",3,"click"],["mat-icon-button","","color","primary","aria-label","D\xE9tails de la famille",3,"click"],["mat-icon-button","","color","warn","aria-label","Supprimer la famille",3,"click"],["mat-header-row",""],["mat-row",""],[1,"d-flex","justify-center","p-24"],["mode","indeterminate"],[1,"p-16","text-muted"]],template:function(n,t){n&1&&(r(0,"mat-card",0)(1,"mat-card-content")(2,"mat-card-title"),s(3,"Liste des familles"),o(),r(4,"div",1)(5,"mat-form-field",2)(6,"mat-label"),s(7,"Rechercher familles / personnes"),o(),r(8,"input",3),v("input",function(c){return t.filter.set(c.target.value)}),o()(),r(9,"div",4),s(10),o()(),_(11,Qe,13,3,"div",5)(12,Xe,2,0,"div",6)(13,Ye,2,0,"div",7),o()()),n&2&&(l(10),f("R\xE9sultats : ",t.filteredFamilles().length),l(),d("ngIf",!t.loading()),l(),d("ngIf",t.loading()),l(),d("ngIf",!t.loading()&&(!t.familles()||t.familles().length===0)))},dependencies:[S,q,z,U,ne,ee,ie,te,Te,xe,ye,Se,De,we,Ie,be,Fe,Ae,Ee,me,oe,ae,re,le,E,A,I,K,ce,se,Me,X,J,W,Z,Y],styles:[".person-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;margin:4px}.person-chip[_ngcontent-%COMP%]   img[matChipAvatar][_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;object-fit:cover;margin-right:8px}.table-responsive[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}"],changeDetection:0});let e=i;return e})();export{Ot as AdminFamilleListComponent};
