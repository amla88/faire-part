import{a as te}from"./chunk-PKM2333C.js";import{w as P}from"./chunk-C3F7AE4G.js";import"./chunk-P64JN6AO.js";import"./chunk-OGSC24V2.js";import"./chunk-ZSBXDNJS.js";import"./chunk-4LRKX244.js";import{a as $}from"./chunk-PWJZ2LNL.js";import"./chunk-ABK7ITGS.js";import"./chunk-SMABRFWC.js";import{b as R,c as V,d as ee,g as U}from"./chunk-2KVVKINI.js";import"./chunk-G46FCTUC.js";import{B as f,E as I,F as j,G as N,I as b,K as B,N as q,Q as D,R as X,T as Y,U as G,X as M,z as T}from"./chunk-OC4T4DRE.js";import{a as Z}from"./chunk-ZZPVTA7Y.js";import{b as z}from"./chunk-KWMSRXNQ.js";import{d as E,i as F}from"./chunk-XYN5C5AP.js";import"./chunk-JPTBIBXE.js";import"./chunk-LKTWXCPZ.js";import{n as L,ta as W,xa as O,za as K}from"./chunk-4THFQO72.js";import{Jb as s,Kb as d,Ob as h,Pb as o,Qb as r,Rb as g,Vb as S,Wb as _,ac as x,cb as a,ea as J,ia as w,ja as k,ob as y,qc as m,sc as Q,ub as A}from"./chunk-XRA3D6DW.js";import{m as v}from"./chunk-SIIEGW5O.js";function ge(t,i){t&1&&(o(0,"mat-error"),m(1,"Le code est requis"),r())}function he(t,i){t&1&&(o(0,"mat-error"),m(1,"Le code doit comporter 8 caract\xE8res"),r())}function Ce(t,i){t&1&&(o(0,"mat-error"),m(1,"Caract\xE8res autoris\xE9s : MAJUSCULES (A\u2013Z) et chiffres (0\u20139)"),r())}function ve(t,i){t&1&&(S(0),m(1,"Se connecter"),_())}function Se(t,i){t&1&&(S(0),g(1,"mat-progress-spinner",14),m(2," \xA0Connexion... "),_()),t&2&&(a(),h("strokeWidth",3))}var H=(()=>{let i=class i{ngOnInit(){let l=this.form.get("token");l?.valueChanges.subscribe(n=>{if(typeof n=="string"){let e=n.toUpperCase().replace(/[^A-Z0-9]/g,"");e!==n&&l.setValue(e,{emitEvent:!1})}})}constructor(l,n,e){this.router=l,this.auth=n,this.snackBar=e,this.loading=!1,this.errorMessage="",this.form=new N({token:new b("",[f.required,f.minLength(8),f.maxLength(8),f.pattern("^[A-Z0-9]+$")])})}get f(){return this.form.controls}submit(){return v(this,null,function*(){if(this.errorMessage="",this.form.invalid){this.errorMessage="Veuillez saisir le code d'acc\xE8s (8 caract\xE8res).";return}let l=this.form.value.token;this.loading=!0;let n=yield this.auth.loginWithToken(l);if(this.loading=!1,!n.success){this.errorMessage=n.error||"Code invalide",this.snackBar.open(this.errorMessage,"OK",{duration:4e3});return}let e=n.user,c="",u=!1;if(e){let p=e.personnes??[];if(p.length===1)u=!0,c=`${p[0].prenom} ${p[0].nom}`;else if(e.selected_personne_id){let C=p.find(re=>re.id===e.selected_personne_id);C&&(u=!0,c=`${C.prenom} ${C.nom}`)}}u&&this.snackBar.open(`Bienvenue ${c}`,"OK",{duration:2e3})})}};i.\u0275fac=function(n){return new(n||i)(y(E),y(z),y(M))},i.\u0275cmp=A({type:i,selectors:[["app-side-login"]],decls:22,vars:8,consts:[[1,"blank-layout-container","justify-content-center","align-items-center","bg-light"],[1,"position-relative","row","w-100","h-100","bg-gredient","justify-content-center"],[1,"col-lg-4","d-flex","align-items-center"],[1,"cardWithShadow","boxed-auth"],[1,"p-32"],[1,"text-center"],["src","./assets/images/logos/dark-logo.svg","alt","logo",1,"align-middle","m-2"],[1,"or-border","m-t-30"],[1,"m-t-30",3,"ngSubmit","formGroup"],[1,"f-s-14","f-w-600","m-b-12","d-block"],["appearance","outline","color","primary",1,"w-100"],["matInput","","formControlName","token","maxlength","8","placeholder","8 caract\xE8res","autocomplete","off"],["align","end"],["mat-flat-button","","color","primary","type","submit",1,"w-100",3,"disabled"],["diameter","18","mode","indeterminate",3,"strokeWidth"]],template:function(n,e){if(n&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-card",3)(4,"mat-card-content",4)(5,"div",5),g(6,"img",6),r(),o(7,"div",7),m(8,"Entre le code d\u2019acc\xE8s ou scanne le code QR"),r(),o(9,"form",8),x("ngSubmit",function(){return e.submit()}),o(10,"mat-label",9),m(11,"Code d'acc\xE8s"),r(),o(12,"mat-form-field",10),g(13,"input",11),o(14,"mat-hint",12),m(15),r(),s(16,ge,2,0,"mat-error"),s(17,he,2,0,"mat-error"),s(18,Ce,2,0,"mat-error"),r(),o(19,"button",13),s(20,ve,2,0,"ng-container"),s(21,Se,3,1,"ng-container"),r()()()()()()()),n&2){let c,u,p,C;a(9),h("formGroup",e.form),a(6),Q("",((c=e.form.get("token"))==null||c.value==null?null:c.value.length)||0,"/8"),a(),d((u=e.form.get("token"))!=null&&u.hasError("required")?16:-1),a(),d((p=e.form.get("token"))!=null&&p.hasError("minlength")||(p=e.form.get("token"))!=null&&p.hasError("maxlength")?17:-1),a(),d((C=e.form.get("token"))!=null&&C.hasError("pattern")?18:-1),a(),h("disabled",e.loading||e.form.invalid),a(),d(e.loading?-1:20),a(),d(e.loading?21:-1)}},dependencies:[L,F,P,U,R,ee,V,$,O,K,W,Z,Y,B,T,I,j,X,G,q,D],encapsulation:2});let t=i;return t})();var ne=(()=>{let i=class i{constructor(l,n,e){this.auth=l,this.router=n,this.snackBar=e}canActivate(l,n){return v(this,null,function*(){let c=(l.paramMap.get("code")||"").toString().toUpperCase().replace(/[^A-Z0-9]/g,"");if(!/^[A-Z0-9]{8}$/.test(c))return yield this.router.navigate(["/authentication/login"],{replaceUrl:!0}),!1;let u=yield this.auth.loginWithTokenSilent(c);if(!u.success)return this.snackBar.open(u.error||"Code invalide","OK",{duration:4e3}),yield this.router.navigate(["/authentication/login"],{replaceUrl:!0}),!1;let p=u.user;return p.personnes&&p.personnes.length>1?(yield this.router.navigate(["/person"],{replaceUrl:!0}),!1):(yield this.router.navigate(["/"],{replaceUrl:!0}),!1)})}};i.\u0275fac=function(n){return new(n||i)(w(z),w(E),w(M))},i.\u0275prov=J({token:i,factory:i.\u0275fac,providedIn:"root"});let t=i;return t})();function _e(t,i){t&1&&(o(0,"mat-error"),m(1,"L'email est requis"),r())}function Ee(t,i){t&1&&(o(0,"mat-error"),m(1,"Email invalide"),r())}function Me(t,i){t&1&&(o(0,"mat-error"),m(1,"Le mot de passe est requis"),r())}function be(t,i){t&1&&(o(0,"mat-error"),m(1,"Au moins 6 caract\xE8res"),r())}function we(t,i){t&1&&(S(0),m(1,"Se connecter"),_())}function ke(t,i){t&1&&(S(0),g(1,"mat-progress-spinner",14),m(2," \xA0Connexion... "),_()),t&2&&(a(),h("strokeWidth",3))}var oe=(()=>{let i=class i{constructor(){this.router=k(E),this.snack=k(M),this.auth=k(te),this.form=new N({email:new b("larive.amaury@gmail.com",[f.required,f.email]),password:new b("cr3ui5n",[f.required,f.minLength(6)])})}get f(){return this.form.controls}submit(){return v(this,null,function*(){if(this.form.invalid)return;let{email:l,password:n}=this.form.value;if(!(yield this.auth.signIn(l,n)).success){this.snack.open(this.auth.error()||"\xC9chec de la connexion","OK",{duration:4e3});return}if(!this.auth.isAdmin()){this.snack.open("Acc\xE8s r\xE9serv\xE9 aux administrateurs","OK",{duration:4e3});return}yield this.router.navigate(["/admin"])})}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=A({type:i,selectors:[["app-admin-login"]],decls:25,vars:8,consts:[[1,"blank-layout-container","justify-content-center","align-items-center","bg-light"],[1,"position-relative","row","w-100","h-100","bg-gredient","justify-content-center"],[1,"col-lg-4","d-flex","align-items-center"],[1,"cardWithShadow","boxed-auth"],[1,"p-32"],[1,"text-center"],["src","./assets/images/logos/dark-logo.svg","alt","logo",1,"align-middle","m-2"],[1,"or-border","m-t-30"],[1,"m-t-30",3,"ngSubmit","formGroup"],[1,"f-s-14","f-w-600","m-b-12","d-block"],["appearance","outline","color","primary",1,"w-100"],["matInput","","formControlName","email","type","email","placeholder","admin@exemple.com","autocomplete","email"],["matInput","","formControlName","password","type","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022","autocomplete","current-password"],["mat-flat-button","","color","primary","type","submit",1,"w-100",3,"disabled"],["diameter","18","mode","indeterminate",3,"strokeWidth"]],template:function(n,e){n&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-card",3)(4,"mat-card-content",4)(5,"div",5),g(6,"img",6),r(),o(7,"div",7),m(8,"Connexion administrateur"),r(),o(9,"form",8),x("ngSubmit",function(){return e.submit()}),o(10,"mat-label",9),m(11,"Email"),r(),o(12,"mat-form-field",10),g(13,"input",11),s(14,_e,2,0,"mat-error"),s(15,Ee,2,0,"mat-error"),r(),o(16,"mat-label",9),m(17,"Mot de passe"),r(),o(18,"mat-form-field",10),g(19,"input",12),s(20,Me,2,0,"mat-error"),s(21,be,2,0,"mat-error"),r(),o(22,"button",13),s(23,we,2,0,"ng-container"),s(24,ke,3,1,"ng-container"),r()()()()()()()),n&2&&(a(9),h("formGroup",e.form),a(5),d(e.f.email.hasError("required")?14:-1),a(),d(e.f.email.hasError("email")?15:-1),a(5),d(e.f.password.hasError("required")?20:-1),a(),d(e.f.password.hasError("minlength")?21:-1),a(),h("disabled",e.auth.loading()||e.form.invalid),a(),d(e.auth.loading()?-1:23),a(),d(e.auth.loading()?24:-1))},dependencies:[L,F,G,B,T,I,j,q,D,P,U,R,V,$,O,K,W,Z],encapsulation:2,changeDetection:0});let t=i;return t})();var Je=[{path:"",children:[{path:"login",component:H},{path:"quick/:code",component:H,canActivate:[ne]},{path:"admin-login",component:oe}]}];export{Je as AuthenticationRoutes};
