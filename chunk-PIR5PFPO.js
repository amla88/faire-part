import{a as Q}from"./chunk-PNMGDGOO.js";import{a as K,b as H}from"./chunk-G46FCTUC.js";import{B as S,S as T,U as F,V as G,W as q,X as J,Y as W}from"./chunk-OC4T4DRE.js";import"./chunk-KWMSRXNQ.js";import"./chunk-XYN5C5AP.js";import"./chunk-JPTBIBXE.js";import"./chunk-LKTWXCPZ.js";import{Aa as A,Ba as B,Ca as V,Ea as N,m as D,n as j,ta as I,w as k,wa as R,xa as L,ya as O,za as z}from"./chunk-4THFQO72.js";import{Ec as E,Gc as x,Jb as m,Kb as u,Ob as g,Pb as l,Qb as n,Rb as P,Yb as M,ab as _,ac as h,cb as s,cc as f,ja as c,pa as v,qa as U,qc as d,ub as C,uc as y,va as w,za as p}from"./chunk-XRA3D6DW.js";import{m as b}from"./chunk-SIIEGW5O.js";function Z(i,o){if(i&1&&(l(0,"div",3)(1,"small"),d(2),E(3,"number"),n()()),i&2){let a=f();s(2),y(" Fichier: ",a.fileInfo().name," \u2022 Type: ",a.fileInfo().type," \u2022 Taille: ",x(3,3,a.fileInfo().size/1024,"1.0-0")," Ko ")}}function $(i,o){if(i&1){let a=M();l(0,"div",4)(1,"img",9),h("error",function(){v(a);let e=f();return U(e.onPreviewError())})("load",function(){v(a);let e=f();return U(e.onPreviewLoad())}),n()()}if(i&2){let a=f();s(),g("src",a.safePreview()||a.previewUrl(),_)}}function ee(i,o){i&1&&(l(0,"div",5)(1,"small"),d(2,"Aper\xE7u indisponible pour ce format d'image, mais l'upload fonctionne quand m\xEAme."),n()())}function te(i,o){i&1&&P(0,"mat-progress-bar",6)}var we=(()=>{let o=class o{constructor(){this.fb=c(T),this.snack=c(J),this.photo=c(Q),this.sanitizer=c(k),this.destroyRef=c(w),this.form=this.fb.group({file:[null,[S.required]]}),this.previewUrl=p(null),this.safePreview=p(null),this.isUploading=p(!1),this.previewError=p(!1),this.objectUrl=null,this.fileInfo=p(null),this.triedDataUrlFallback=!1}onFileChange(r){let e=r.target,t=e.files&&e.files[0]?e.files[0]:null;if(this.form.patchValue({file:t}),t){this.previewError.set(!1),this.fileInfo.set({name:t.name,type:t.type||"inconnu",size:t.size}),this.objectUrl&&(URL.revokeObjectURL(this.objectUrl),this.objectUrl=null),this.triedDataUrlFallback=!1;try{this.objectUrl=URL.createObjectURL(t),this.previewUrl.set(this.objectUrl),this.safePreview.set(this.sanitizer.bypassSecurityTrustUrl(this.objectUrl))}catch{this.readAsDataUrl(t)}}else this.previewUrl.set(null),this.safePreview.set(null),this.fileInfo.set(null),this.previewError.set(!1),this.objectUrl&&(URL.revokeObjectURL(this.objectUrl),this.objectUrl=null)}onPreviewError(){let r=this.form.value.file||null;if(r&&!this.triedDataUrlFallback){this.triedDataUrlFallback=!0,this.readAsDataUrl(r);return}this.previewError.set(!0)}onPreviewLoad(){this.previewError.set(!1)}readAsDataUrl(r){let e=new FileReader;e.onload=()=>{let t=typeof e.result=="string"?e.result:null;this.previewUrl.set(t),this.safePreview.set(t?this.sanitizer.bypassSecurityTrustUrl(t):null)},e.onerror=()=>{this.previewUrl.set(null),this.safePreview.set(null),this.previewError.set(!0)},e.readAsDataURL(r)}submit(){return b(this,null,function*(){let r=this.form.value.file;if(r){this.isUploading.set(!0);try{let e=yield this.photo.uploadGuestPhoto(r);this.snack.open("Photo envoy\xE9e pour mod\xE9ration",void 0,{duration:3e3}),this.form.reset(),this.previewUrl.set(null),this.safePreview.set(null),this.fileInfo.set(null),this.previewError.set(!1),this.objectUrl&&(URL.revokeObjectURL(this.objectUrl),this.objectUrl=null)}catch(e){console.error("Upload error",e),this.snack.open(e?.message||"\xC9chec de l'upload","OK",{duration:5e3})}finally{this.isUploading.set(!1)}}})}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=C({type:o,selectors:[["app-photo-upload"]],decls:18,vars:5,consts:[["appearance","outlined"],[1,"picker"],["type","file","accept","image/*",3,"change"],[1,"file-info"],[1,"preview"],[1,"hint","error"],["mode","indeterminate"],["align","end"],["mat-raised-button","","color","primary",3,"click","disabled"],["alt","Aper\xE7u",3,"error","load","src"]],template:function(e,t){e&1&&(l(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),d(3,"T\xE9l\xE9verser une photo"),n(),l(4,"mat-card-subtitle"),d(5,"Formats accept\xE9s: JPG, PNG, WebP, GIF. Taille max selon configuration du bucket."),n()(),l(6,"mat-card-content")(7,"div",1)(8,"input",2),h("change",function(Y){return t.onFileChange(Y)}),n()(),m(9,Z,4,6,"div",3),m(10,$,2,1,"div",4),m(11,ee,3,0,"div",5),m(12,te,1,0,"mat-progress-bar",6),n(),l(13,"mat-card-actions",7)(14,"button",8),h("click",function(){return t.submit()}),l(15,"mat-icon"),d(16,"cloud_upload"),n(),d(17," Envoyer "),n()()()),e&2&&(s(9),u(t.fileInfo()?9:-1),s(),u(t.safePreview()||t.previewUrl()?10:-1),s(),u(t.previewError()?11:-1),s(),u(t.isUploading()?12:-1),s(2),g("disabled",!t.form.valid||t.isUploading()))},dependencies:[j,F,N,L,B,z,V,A,O,R,I,q,G,H,K,W,D],styles:[".picker[_ngcontent-%COMP%]{margin:12px 0}.preview[_ngcontent-%COMP%]{margin:12px 0 4px;display:flex;justify-content:center}.preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;height:auto;border-radius:8px;box-shadow:0 2px 6px #0000002e}"],changeDetection:0});let i=o;return i})();export{we as PhotoUploadComponent};
