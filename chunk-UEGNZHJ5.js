import{a as ie,b as ae}from"./chunk-ABK7ITGS.js";import{b as K,e as J,f as Q}from"./chunk-SMABRFWC.js";import{b as W,g as G,j as $}from"./chunk-2KVVKINI.js";import{E as F,J as q,T as j,V as re,W as oe,X as de,Y as ce,z as R}from"./chunk-OC4T4DRE.js";import{a as se,b as le}from"./chunk-ZZPVTA7Y.js";import{a as pe,b as ue}from"./chunk-KWMSRXNQ.js";import"./chunk-XYN5C5AP.js";import{a as me}from"./chunk-JPTBIBXE.js";import"./chunk-LKTWXCPZ.js";import{Ca as te,Ea as ne,n as N,sa as V,ta as Y,wa as H,xa as X,ya as Z,za as ee}from"./chunk-4THFQO72.js";import{Jb as y,Kb as S,Mb as A,Mc as I,Nb as T,Nc as L,Ob as f,Pb as n,Qb as i,Rb as _,ab as w,ac as m,cb as l,cc as P,ja as C,oc as v,qc as r,rc as O,sc as E,ub as z,vc as D,wc as B,xc as U,za as h}from"./chunk-XRA3D6DW.js";import{m as x}from"./chunk-SIIEGW5O.js";var ge=(d,c)=>c.name;function he(d,c){d&1&&_(0,"mat-spinner",6)}function fe(d,c){if(d&1&&_(0,"img",7),d&2){let p,e=P();f("src",e.avatarDataUri(),w)("alt","Avatar - "+((p=e.currentStyle())==null?null:p.label))}}function _e(d,c){if(d&1&&(n(0,"mat-option",17),r(1),i()),d&2){let p=c.$implicit;f("value",p.name),l(),E(" ",p.label," ")}}function ve(d,c){if(d&1&&(n(0,"div",26)(1,"h3"),r(2),i(),n(3,"p"),r(4," Style actuellement s\xE9lectionn\xE9: "),n(5,"strong"),r(6),i()(),n(7,"p",27),r(8," Utilisez cet \xE9diteur pour cr\xE9er et personnaliser votre avatar. Les modifications sont appliqu\xE9es en temps r\xE9el. "),i()()),d&2){let p,e=P();l(2),O((p=e.currentStyle())==null?null:p.label),l(4),O(e.selectedStyle())}}var Ve=(()=>{let c=class c{constructor(){this.styles=[{name:"personas",label:"Personas"},{name:"avataaars",label:"Avataaars"},{name:"dylan",label:"Dylan"},{name:"openPeeps",label:"Open Peeps"},{name:"pixelArt",label:"Pixel Art"}],this.selectedStyle=h("personas"),this.seed=h("default-seed"),this.size=h(256),this.isLoading=h(!1),this.avatarDataUri=h(""),this.snackBar=C(de),this.supabase=C(me),this.auth=C(ue),this.avatarService=C(pe),this.isSaving=h(!1),this.currentStyle=I(()=>this.styles.find(a=>a.name===this.selectedStyle())),L(()=>{this.generateAvatar()});let e=this.auth.getUser();if(e&&e.selected_personne_id&&e.avatars&&e.avatars[e.selected_personne_id]){let a=e.avatars[e.selected_personne_id];if(a.seed&&this.seed.set(a.seed),a.options){let t=a.options;t.style&&this.selectedStyle.set(t.style),typeof t.size=="number"&&this.size.set(t.size)}}}loadAvatar(){return x(this,null,function*(){try{let e=this.auth.getUser();if(!e||!e.selected_personne_id)return;let a=this.auth.getToken();if(!a)return;this.isLoading.set(!0);let s=yield this.supabase.getClient().rpc("get_avatar_for_token",{p_token:a,p_personne_id:e.selected_personne_id});if(s.error){console.error("Erreur get_avatar_for_token",s.error);return}let o=s.data;if(Array.isArray(o)&&(o=o[0]||null),!o)return;if(o.seed&&this.seed.set(o.seed),o.options){let g=o.options;g.style&&this.selectedStyle.set(g.style),typeof g.size=="number"&&this.size.set(g.size)}}catch(e){console.error("Erreur lors du chargement de l'avatar",e)}finally{this.isLoading.set(!1)}})}generateAvatar(){try{this.isLoading.set(!0);let e=this.currentStyle();if(!e)return;let a=this.avatarService.generateDataUri(e.name,this.seed(),this.size());a&&this.avatarDataUri.set(a)}catch(e){console.error("Erreur lors de la g\xE9n\xE9ration de l'avatar:",e)}finally{this.isLoading.set(!1)}}onStyleChange(e){this.selectedStyle.set(e)}onSeedChange(e){this.seed.set(e)}onSizeChange(e){this.size.set(e)}generateRandomSeed(){let e=Math.random().toString(36).substring(2,15);this.seed.set(e)}saveAvatar(){return x(this,null,function*(){let e=this.auth.getUser();if(!e||!e.selected_personne_id){this.snackBar.open("Aucune personne s\xE9lectionn\xE9e. Veuillez choisir une personne.","OK",{duration:4e3});return}let a=e.selected_personne_id,t=this.seed(),s={style:this.selectedStyle(),size:this.size()};this.isSaving.set(!0);try{let o=this.supabase.getClient(),g=this.auth.getToken();if(!g){this.snackBar.open("Token manquant \u2014 reconnectez-vous","OK",{duration:4e3});return}let b=yield o.rpc("upsert_avatar_for_token",{p_token:g,p_personne_id:a,p_seed:t,p_options:s});if(b.error){console.error("RPC upsert_avatar_for_token error",b.error),this.snackBar.open("Erreur lors de l'enregistrement de l'avatar: "+(b.error.message||b.error.code||""),"OK",{duration:5e3});return}let u=b.data;Array.isArray(u)&&(u=u[0]||null);try{let M=this.currentStyle(),k=this.avatarService.generateDataUri(M?.name,t,35);u&&k&&(u.imageDataUri=k),this.auth.setAvatarInCache(a,u||{seed:t,options:s})}catch(M){console.error("Erreur generation image pour cache",M),u&&this.auth.setAvatarInCache(a,u)}this.snackBar.open("Avatar enregistr\xE9",void 0,{duration:2e3})}catch(o){console.error("Erreur saveAvatar",o),this.snackBar.open("Impossible d'enregistrer l'avatar","OK",{duration:4e3})}finally{this.isSaving.set(!1)}})}downloadAvatar(){try{let e=this.avatarDataUri();if(!e){this.snackBar.open("Aucun avatar disponible pour le t\xE9l\xE9chargement","OK",{duration:3e3});return}let a=document.createElement("a");a.href=e,a.download=`avatar-${this.seed()}.png`,document.body.appendChild(a),a.click(),a.remove(),this.snackBar.open("T\xE9l\xE9chargement lanc\xE9",void 0,{duration:2e3})}catch(e){console.error("Erreur lors du t\xE9l\xE9chargement de l'avatar",e),this.snackBar.open("Impossible de t\xE9l\xE9charger l'avatar","OK",{duration:3e3})}}copyToClipboard(){let e=this.avatarDataUri();if(!e){this.snackBar.open("Aucun avatar \xE0 copier","OK",{duration:3e3});return}if(!navigator.clipboard){this.snackBar.open("Presse-papiers non support\xE9","OK",{duration:3e3});return}navigator.clipboard.writeText(e).then(()=>this.snackBar.open("Data URI copi\xE9",void 0,{duration:2e3})).catch(a=>{console.error("Erreur copie presse-papiers",a),this.snackBar.open("Impossible de copier dans le presse-papiers","OK",{duration:3e3})})}};c.\u0275fac=function(a){return new(a||c)},c.\u0275cmp=z({type:c,selectors:[["app-avatar-editor"]],decls:69,vars:17,consts:[[1,"avatar-editor-container"],[1,"editor-header"],[1,"subtitle"],[1,"editor-content"],[1,"preview-section"],[1,"preview-container"],["diameter","100"],[1,"avatar-preview",3,"src","alt"],[1,"preview-actions"],["mat-raised-button","","color","primary",1,"action-btn",3,"click"],["mat-raised-button","","color","accent",1,"action-btn",3,"click"],["mat-raised-button","",1,"action-btn",3,"click"],["mat-raised-button","","color","primary",1,"action-btn",3,"click","disabled"],[1,"settings-section"],[1,"setting-group"],["appearance","outline",1,"full-width"],[3,"selectionChange","value"],[3,"value"],[1,"my-4"],[1,"setting-label"],[1,"seed-input-group"],["type","text","placeholder","Entrez une seed unique",1,"seed-input",3,"ngModelChange","change","ngModel"],["mat-icon-button","","title","G\xE9n\xE9rer une seed al\xE9atoire",3,"click"],["type","range","min","64","max","512","step","32",1,"size-slider",3,"input","value"],[1,"size-presets"],["mat-stroked-button","",1,"preset-btn",3,"click"],[1,"style-info"],[1,"info-text"]],template:function(a,t){a&1&&(n(0,"div",0)(1,"div",1)(2,"h1"),r(3,"\xC9diteur d'Avatar"),i(),n(4,"p",2),r(5,"Personnalisez votre avatar pour le mariage"),i()(),n(6,"div",3)(7,"mat-card",4)(8,"mat-card-header")(9,"mat-card-title"),r(10,"Aper\xE7u"),i()(),n(11,"mat-card-content")(12,"div",5),y(13,he,1,0,"mat-spinner",6)(14,fe,1,2,"img",7),i(),n(15,"div",8)(16,"button",9),m("click",function(){return t.generateRandomSeed()}),n(17,"mat-icon"),r(18,"casino"),i(),r(19," G\xE9n\xE9rer al\xE9atoire "),i(),n(20,"button",10),m("click",function(){return t.downloadAvatar()}),n(21,"mat-icon"),r(22,"download"),i(),r(23," T\xE9l\xE9charger "),i(),n(24,"button",11),m("click",function(){return t.copyToClipboard()}),n(25,"mat-icon"),r(26,"content_copy"),i(),r(27," Copier "),i(),n(28,"button",12),m("click",function(){return t.saveAvatar()}),n(29,"mat-icon"),r(30,"save"),i(),r(31," Enregistrer "),i()()()(),n(32,"mat-card",13)(33,"mat-card-header")(34,"mat-card-title"),r(35,"Param\xE8tres"),i()(),n(36,"mat-card-content")(37,"div",14)(38,"mat-form-field",15)(39,"mat-label"),r(40,"Style d'avatar"),i(),n(41,"mat-select",16),m("selectionChange",function(o){return t.onStyleChange(o.value)}),A(42,_e,2,2,"mat-option",17,ge),i()()(),_(44,"mat-divider",18),n(45,"div",14)(46,"label",19),r(47,"Seed (identifiant unique)"),i(),n(48,"div",20)(49,"input",21),U("ngModelChange",function(o){return B(t.seed,o)||(t.seed=o),o}),m("change",function(o){return t.onSeedChange(o.target.value)}),i(),n(50,"button",22),m("click",function(){return t.generateRandomSeed()}),n(51,"mat-icon"),r(52,"refresh"),i()()()(),_(53,"mat-divider",18),n(54,"div",14)(55,"label",19),r(56),i(),n(57,"input",23),m("input",function(o){return t.onSizeChange(+o.target.value)}),i(),n(58,"div",24)(59,"button",25),m("click",function(){return t.onSizeChange(96)}),r(60," 96px "),i(),n(61,"button",25),m("click",function(){return t.onSizeChange(128)}),r(62," 128px "),i(),n(63,"button",25),m("click",function(){return t.onSizeChange(256)}),r(64," 256px "),i(),n(65,"button",25),m("click",function(){return t.onSizeChange(512)}),r(66," 512px "),i()()(),_(67,"mat-divider",18),y(68,ve,9,2,"div",26),i()()()()),a&2&&(l(12),v("loading",t.isLoading()),l(),S(t.isLoading()?13:14),l(15),f("disabled",t.isLoading()||t.isSaving()||!t.avatarDataUri()),l(13),f("value",t.selectedStyle()),l(),T(t.styles),l(7),D("ngModel",t.seed),l(7),E("Taille: ",t.size(),"px"),l(),f("value",t.size()),l(2),v("active",t.size()===96),l(2),v("active",t.size()===128),l(2),v("active",t.size()===256),l(2),v("active",t.size()===512),l(3),S(t.currentStyle()?68:-1))},dependencies:[N,j,R,F,q,H,Y,V,ne,X,ee,te,Z,Q,G,W,J,K,$,ae,ie,oe,re,le,se,ce],styles:[".avatar-editor-container[_ngcontent-%COMP%]{min-height:100vh;padding:2rem;background:linear-gradient(135deg,#f5f7fa,#c3cfe2)}@media (max-width: 768px){.avatar-editor-container[_ngcontent-%COMP%]{padding:1rem}}.editor-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:3rem}.editor-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:#2c3e50;margin:0 0 .5rem}@media (max-width: 768px){.editor-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem}}.editor-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{font-size:1.1rem;color:#7f8c8d;margin:0}.editor-content[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:1fr 1fr;gap:2rem}@media (max-width: 768px){.editor-content[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:1.5rem}}mat-card[_ngcontent-%COMP%]{border-radius:12px;box-shadow:0 4px 20px #0000001a;transition:box-shadow .3s ease,transform .3s ease}mat-card[_ngcontent-%COMP%]:hover{box-shadow:0 8px 32px #00000026;transform:translateY(-2px)}mat-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}mat-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#2c3e50;margin:0}mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding-top:0}.preview-section[_ngcontent-%COMP%]{display:flex;flex-direction:column}.preview-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#ffecd2,#fcb69f);border-radius:8px;padding:2rem;min-height:300px;margin-bottom:1.5rem;position:relative}.preview-container.loading[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f5f7fa,#c3cfe2)}.avatar-preview[_ngcontent-%COMP%]{max-width:100%;max-height:300px;border-radius:8px;box-shadow:0 8px 24px #0000001f;animation:_ngcontent-%COMP%_fadeIn .3s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.preview-actions[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.75rem}@media (max-width: 768px){.preview-actions[_ngcontent-%COMP%]{flex-direction:column}}.action-btn[_ngcontent-%COMP%]{flex:1;min-width:120px;display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.75rem 1.5rem;border-radius:6px;font-weight:500;transition:all .2s ease}@media (max-width: 768px){.action-btn[_ngcontent-%COMP%]{flex:none;width:100%}}.action-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 12px #00000026}.settings-section[_ngcontent-%COMP%]{display:flex;flex-direction:column}.setting-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.setting-group[_ngcontent-%COMP%]:last-child{margin-bottom:0}.setting-label[_ngcontent-%COMP%]{display:block;font-size:.95rem;font-weight:600;color:#2c3e50;margin-bottom:.75rem;text-transform:uppercase;letter-spacing:.5px}.full-width[_ngcontent-%COMP%]{width:100%}.seed-input-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.seed-input[_ngcontent-%COMP%]{flex:1;padding:.75rem;border:2px solid #e0e0e0;border-radius:6px;font-size:.95rem;transition:border-color .2s ease}.seed-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3f51b5}.seed-input[_ngcontent-%COMP%]::placeholder{color:#bdbdbd}.size-slider[_ngcontent-%COMP%]{width:100%;height:6px;border-radius:3px;background:linear-gradient(to right,#e0e0e0,#bdbdbd);outline:none;-webkit-appearance:none;appearance:none;margin:1rem 0}.size-slider[_ngcontent-%COMP%]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:20px;height:20px;border-radius:50%;background:#3f51b5;cursor:pointer;box-shadow:0 2px 8px #3f51b566;transition:box-shadow .2s ease}.size-slider[_ngcontent-%COMP%]::-webkit-slider-thumb:hover{box-shadow:0 4px 12px #3f51b599}.size-slider[_ngcontent-%COMP%]::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:#3f51b5;cursor:pointer;border:none;box-shadow:0 2px 8px #3f51b566;transition:box-shadow .2s ease}.size-slider[_ngcontent-%COMP%]::-moz-range-thumb:hover{box-shadow:0 4px 12px #3f51b599}.size-presets[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:.5rem;margin-top:1rem}@media (max-width: 768px){.size-presets[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}.preset-btn[_ngcontent-%COMP%]{border-radius:6px;font-size:.85rem;font-weight:500;transition:all .2s ease}.preset-btn.active[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;border-color:#3f51b5}.preset-btn[_ngcontent-%COMP%]:hover:not(.active){border-color:#3f51b5;color:#3f51b5}  .mat-divider{margin:1.5rem 0}.my-4[_ngcontent-%COMP%]{margin:1.5rem 0}.style-info[_ngcontent-%COMP%]{background:#f5f7fa;padding:1rem;border-radius:6px;border-left:4px solid #3f51b5}.style-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;color:#2c3e50;margin:0 0 .5rem}.style-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;color:#7f8c8d;margin:.25rem 0}.style-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#2c3e50;font-weight:600}.style-info[_ngcontent-%COMP%]   .info-text[_ngcontent-%COMP%]{margin-top:.75rem;line-height:1.5}@media (max-width: 768px){.avatar-editor-container[_ngcontent-%COMP%]{padding:1rem}.editor-content[_ngcontent-%COMP%]{grid-template-columns:1fr}.preview-container[_ngcontent-%COMP%]{min-height:250px}.avatar-preview[_ngcontent-%COMP%]{max-height:250px}}"],changeDetection:0});let d=c;return d})();export{Ve as AvatarEditorComponent};
